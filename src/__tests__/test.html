<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<body>
  <div id="app">
    <script type="module">
      import { h, mount, Cortex, css } from "../../dist/humn.js";

      const todoStore = new Cortex({
        memory: {
          items: [
            { id: 1, text: "Create Humn Library", done: true },
            { id: 2, text: "Write first app", done: false },
          ],
          inputValue: "",
          errorMessage: ""
        },

        synapses: (set, get) => ({
          updateInput: (val) => set({ inputValue: val }),

          addTodo: () =>
            set((state) => {
              state.errorMessage = ''

              if (state.inputValue.length < 5) {
                state.errorMessage = 'Task title too short'
                return
              }

              state.items.push({
                id: Date.now(),
                text: state.inputValue,
                done: false,
              });
              state.inputValue = "";
            }),

          toggle: (id) =>
            set((state) => {
              const item = state.items.find((i) => i.id === id);
              if (item) item.done = !item.done;
            }),
        }),
      });

      const scopeClass = css`
        /* Layout for the container */
        font-family: sans-serif;
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;

        /* Target Children */
        h1 {
          color: #333;
          text-align: center;
        }

        input {
          padding: 10px;
          width: 70%;
          margin-right: 5px;
        }

        button {
          padding: 10px;
          width: 25%;
          cursor: pointer;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 4px;
        }

        /* Target Specific Classes */
        .card {
          background: #f4f4f4;
          padding: 15px;
          margin-top: 10px;
          border-radius: 8px;
          display: flex;
          justify-content: space-between;
          cursor: pointer;
        }

        .card:hover {
          background: #e0e0e0;
        }

        /* "&" is only needed if you want to modify the selector itself,
          or chained classes on children */
        .card.done {
          text-decoration: line-through;
          opacity: 0.6;
        }
        
        .error {
          color: red;
          font-size: 0.9em;
        }
      `;

      const App = () => {
        const { items, inputValue, errorMessage } = todoStore.memory;
        const { addTodo, toggle, updateInput } = todoStore.synapses;

        // We apply 'scopeClass' to the ROOT element.
        // All styles inside it will now apply to children.
        return h("div", { class: scopeClass }, [
          h("h1", {}, "Humn Todo"),

          h("div", {}, [
            h("input", {
              value: inputValue,
              oninput: (e) => updateInput(e.target.value),
              placeholder: "What needs doing?"
            }),
            h("button", { onclick: addTodo }, "Add"),
          ]),

          errorMessage ? h("p", { class: "error" }, errorMessage) : null,

          h("div", {}, items.map((item) =>
            h("div",
              {
                // We just use the class name defined in CSS
                class: `card ${item.done ? 'done' : ''}`,
                onclick: () => toggle(item.id),
              },
              item.text
            )
          )),
        ]);
      };

      mount(document.getElementById('app'), App);
    </script>
</body>

</html>